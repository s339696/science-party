package models.ebean;

import com.avaje.ebean.Model;
import com.fasterxml.jackson.annotation.JsonIgnore;

import javax.persistence.*;
import javax.validation.constraints.Size;
import java.util.List;

@Entity
@Table(name="perks_per_topic")
public class PerkPerTopic extends Model {

    // Finder
    public static Finder<Long,PerkPerTopic> find = new Finder<>(PerkPerTopic.class);

    // Columns
    @Id
    @GeneratedValue
    private Long id;

    @Size(max=32)
    @Column(name="qr_code")
    private String qrCode;

    @ManyToOne
    private Perk perk;

    @ManyToOne
    private Topic topic;

    @OneToMany(mappedBy="perkPerTopic", cascade= CascadeType.ALL)
    private List<PerkPerUser> usersPerPerk;

    static public PerkPerTopic getPerkPerTopicByQrCode(String qrCode) {
        return PerkPerTopic.find.where()
                .ieq("qrCode", qrCode).findUnique();
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getQrCode() {
        return qrCode;
    }

    /**
     * Sets the QR Code of a perk related to a topic.
     * The QR Code is greated in following way:
     * --> md5hash(name_from_perk + " " + name_from_topic)
     *
     * @param qrCode
     */
    public void setQrCode(String qrCode) {
        this.qrCode = qrCode;
    }

    @JsonIgnore
    public Perk getPerk() {
        return perk;
    }

    @JsonIgnore
    public void setPerk(Perk perk) {
        this.perk = perk;
    }

    @JsonIgnore
    public Topic getTopic() {
        return topic;
    }

    @JsonIgnore
    public void setTopic(Topic topic) {
        this.topic = topic;
    }

    public String getPerkName() {
       return perk.getName();
    }


    public String getTopicName() {
        return topic.getName();
    }

}
